var t=Object.defineProperty;var C=(e,s,n)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n;var y=(t,e,s)=>C(t,typeof e!="symbol"?e+"":e,s);const e={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}},R=(t,e,s)=>t.replaceAll(e,"").replace(s,".").replace("..",".").replace(/[^.\d]/g,""),I=(t,e,s)=>{var n;return new Intl.NumberFormat(((n=s.number)==null?void 0:n.locale)??"en",{minimumFractionDigits:t,maximumFractionDigits:e,roundingMode:"trunc"})},F=(t,e=!0,s)=>{var n,a,i,r;const o=((n=s.number)==null?void 0:n.unsigned)==null&&t.startsWith("-")?"-":"",l=((a=s.number)==null?void 0:a.fraction)??0;let u=I(0,l,s);const p=u.formatToParts(1000.12),h=((i=p.find((t=>t.type==="group")))==null?void 0:i.value)??" ",c=((r=p.find((t=>t.type==="decimal")))==null?void 0:r.value)??".",m=R(t,h,c);if(m===""||Number.isNaN(m))return o;const d=m.split(".");if(d[1]!=null&&d[1].length>=1){const t=d[1].length<=l?d[1].length:l;u=I(t,l,s)}let k=u.format(parseFloat(m));return e?l>0&&m.endsWith(".")&&!m.slice(0,-1).includes(".")&&(k+=c):k=R(k,h,c),o+k};class T{constructor(t={}){y(this,"opts",{});y(this,"memo",new Map);const s={...t};if(s.tokens!=null){s.tokens=s.tokensReplace?{...s.tokens}:{...e,...s.tokens};for(const t of Object.values(s.tokens))typeof t.pattern=="string"&&(t.pattern=new RegExp(t.pattern))}else s.tokens=e;Array.isArray(s.mask)&&(s.mask.length>1?s.mask=[...s.mask].sort(((t,e)=>t.length-e.length)):s.mask=s.mask[0]??""),s.mask===""&&(s.mask=null),this.opts=s}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(t){const e=this.findMask(t);if(this.opts.mask==null||e==null)return!1;const s=this.process(t,e).length;return typeof this.opts.mask=="string"?s>=this.opts.mask.length:s>=e.length}findMask(t){const e=this.opts.mask;if(e==null)return null;if(typeof e=="string")return e;if(typeof e=="function")return e(t);const s=this.process(t,e.slice(-1).pop()??"",!1);return e.find((e=>this.process(t,e,!1).length>=s.length))??""}escapeMask(t){const e=[],s=[];return t.split("").forEach(((n,a)=>{n==="!"&&t[a-1]!=="!"?s.push(a-s.length):e.push(n)})),{mask:e.join(""),escaped:s}}process(t,e,s=!0){if(this.opts.number!=null)return F(t,s,this.opts);if(e==null)return t;const n=`v=${t},mr=${e},m=${s?1:0}`;if(this.memo.has(n))return this.memo.get(n);const{mask:a,escaped:i}=this.escapeMask(e),r=[],o=this.opts.tokens!=null?this.opts.tokens:{},l=this.isReversed()?-1:1,u=this.isReversed()?"unshift":"push",p=this.isReversed()?0:a.length-1,h=this.isReversed()?()=>d>-1&&k>-1:()=>d<a.length&&k<t.length,E=t=>!this.isReversed()&&t<=p||this.isReversed()&&t>=p;let c,m=-1,d=this.isReversed()?a.length-1:0,k=this.isReversed()?t.length-1:0,g=!1;for(;h();){const e=a.charAt(d),n=o[e],h=(n==null?void 0:n.transform)!=null?n.transform(t.charAt(k)):t.charAt(k);if(i.includes(d)||n==null?(s&&!this.isEager()&&r[u](e),h!==e||this.isEager()?c=e:k+=l,this.isEager()||(d+=l)):(h.match(n.pattern)!=null?(r[u](h),n.repeated?(m===-1?m=d:d===p&&d!==m&&(d=m-l),p===m&&(d-=l)):n.multiple&&(g=!0,d-=l),d+=l):n.multiple?g&&(d+=l,k-=l,g=!1):h===c?c=void 0:n.optional&&(d+=l,k-=l),k+=l),this.isEager())for(;E(d)&&(o[a.charAt(d)]==null||i.includes(d));){if(s){if(r[u](a.charAt(d)),t.charAt(k)===a.charAt(d)){d+=l,k+=l;continue}}else a.charAt(d)===t.charAt(k)&&(k+=l);d+=l}}return this.memo.set(n,r.join("")),this.memo.get(n)}}const w=t=>JSON.parse(t.replaceAll("'",'"')),x=(t,e={})=>{const s={...e};t.dataset.maska!=null&&t.dataset.maska!==""&&(s.mask=W(t.dataset.maska)),t.dataset.maskaEager!=null&&(s.eager=A(t.dataset.maskaEager)),t.dataset.maskaReversed!=null&&(s.reversed=A(t.dataset.maskaReversed)),t.dataset.maskaTokensReplace!=null&&(s.tokensReplace=A(t.dataset.maskaTokensReplace)),t.dataset.maskaTokens!=null&&(s.tokens=O(t.dataset.maskaTokens));const n={};return t.dataset.maskaNumberLocale!=null&&(n.locale=t.dataset.maskaNumberLocale),t.dataset.maskaNumberFraction!=null&&(n.fraction=parseInt(t.dataset.maskaNumberFraction)),t.dataset.maskaNumberUnsigned!=null&&(n.unsigned=A(t.dataset.maskaNumberUnsigned)),(t.dataset.maskaNumber!=null||Object.values(n).length>0)&&(s.number=n),s},A=t=>t===""||!!JSON.parse(t),W=t=>t.startsWith("[")&&t.endsWith("]")?w(t):t,O=t=>{if(t.startsWith("{")&&t.endsWith("}"))return w(t);const e={};return t.split("|").forEach((t=>{const s=t.split(":");e[s[0]]={pattern:new RegExp(s[1]),optional:s[2]==="optional",multiple:s[2]==="multiple",repeated:s[2]==="repeated"}})),e};class L{constructor(t,e={}){y(this,"items",new Map);y(this,"onInput",(t=>{if(t instanceof CustomEvent&&t.type==="input")return;const e=t.target,s=this.items.get(e),n="inputType"in t&&t.inputType.startsWith("delete"),a=s.isEager(),i=n&&a&&s.unmasked(e.value)===""?"":e.value;this.fixCursor(e,n,(()=>this.setValue(e,i)))}));this.options=e,this.init(this.getInputs(t))}update(t={}){this.options={...t},this.init(Array.from(this.items.keys()))}updateValue(t){t.value!==""&&t.value!==this.processInput(t).masked&&this.setValue(t,t.value)}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.onInput);this.items.clear()}init(t){const e=this.getOptions(this.options);for(const s of t){this.items.has(s)||s.addEventListener("input",this.onInput,{capture:!0});const t=new T(x(s,e));this.items.set(s,t),queueMicrotask((()=>this.updateValue(s))),s.selectionStart===null&&t.isEager()&&console.warn("Maska: input of `%s` type is not supported",s.type)}}getInputs(t){return typeof t=="string"?Array.from(document.querySelectorAll(t)):"length"in t?Array.from(t):[t]}getOptions(t){const{onMaska:e,preProcess:s,postProcess:n,...a}=t;return a}fixCursor(t,e,s){const n=t.selectionStart,a=t.value;if(s(),n===null||n===a.length&&!e)return;const i=t.value,r=a.slice(0,n),o=i.slice(0,n),l=this.processInput(t,r).unmasked,u=this.processInput(t,o).unmasked;let p=n;r!==o&&(p+=e?i.length-a.length:l.length-u.length),t.setSelectionRange(p,p)}setValue(t,e){const s=this.processInput(t,e);t.value=s.masked,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach((t=>t(s))):this.options.onMaska(s)),t.dispatchEvent(new CustomEvent("maska",{detail:s})),t.dispatchEvent(new CustomEvent("input",{detail:s.masked}))}processInput(t,e){const s=this.items.get(t);let n=e??t.value;this.options.preProcess!=null&&(n=this.options.preProcess(n));let a=s.masked(n);return this.options.postProcess!=null&&(a=this.options.postProcess(a)),{masked:a,unmasked:s.unmasked(n),completed:s.completed(n)}}}export{T as Mask,L as MaskInput,e as tokens};

